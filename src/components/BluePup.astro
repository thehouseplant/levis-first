---
/**
 * BluePup — an original animated blue puppy that hangs out
 * on the side of the screen, bounces, wags its tail, and
 * occasionally pops up with a paw-print thought bubble.
 *
 * This is NOT a copyrighted character — it's an original
 * generic blue puppy mascot inspired by the party theme.
 */
---

<div class="blue-pup-container" id="blue-pup" aria-hidden="true">
  <div class="thought-bubble" id="pup-thought">
    <svg viewBox="0 0 60 60" width="20" fill="var(--blue)">
      <ellipse cx="30" cy="38" rx="14" ry="16" />
      <ellipse cx="16" cy="20" rx="7" ry="8" />
      <ellipse cx="44" cy="20" rx="7" ry="8" />
      <ellipse cx="22" cy="10" rx="6" ry="7" />
      <ellipse cx="38" cy="10" rx="6" ry="7" />
    </svg>
  </div>
  <div class="pup-body">
    <img src="/images/clue-badge.png" alt="" class="pup-img" width="90" height="90" />
  </div>
</div>

<script>
  function initPup() {
    const pup = document.getElementById('blue-pup');
    const thought = document.getElementById('pup-thought');
    if (!pup || !thought) return;

    let lastScroll = 0;
    let hideTimer: number;
    let thoughtTimer: number;

    // Show thought bubble periodically
    function showThought() {
      thought.classList.add('visible');
      setTimeout(() => thought.classList.remove('visible'), 2500);
    }

    // Bounce on scroll
    window.addEventListener('scroll', () => {
      const y = window.scrollY;
      const isScrollingDown = y > lastScroll;
      lastScroll = y;

      pup.classList.add('bouncing');
      pup.classList.toggle('peek-more', y > 200);

      clearTimeout(hideTimer);
      hideTimer = window.setTimeout(() => {
        pup.classList.remove('bouncing');
      }, 600);
    });

    // Periodic thought bubble
    thoughtTimer = window.setInterval(showThought, 8000);

    // Initial entrance
    setTimeout(() => {
      pup.classList.add('entered');
    }, 2000);

    // First thought
    setTimeout(showThought, 4000);
  }

  initPup();
</script>

<style>
  .blue-pup-container {
    position: fixed;
    bottom: -20px;
    right: -30px;
    z-index: 100;
    transform: translateX(60px);
    transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    pointer-events: none;
    filter: drop-shadow(0 4px 12px rgba(42, 127, 255, 0.2));
  }

  .blue-pup-container.entered {
    transform: translateX(20px);
  }

  .blue-pup-container.peek-more {
    transform: translateX(8px);
  }

  .pup-img {
    width: clamp(70px, 15vw, 95px);
    height: auto;
    object-fit: contain;
    transform: scaleX(-1);
    filter: drop-shadow(0 3px 8px rgba(42, 127, 255, 0.2));
  }

  /* Bounce animation on scroll */
  .blue-pup-container.bouncing .pup-body {
    animation: pup-bounce 0.5s ease;
  }

  @keyframes pup-bounce {
    0%, 100% { transform: translateY(0); }
    40% { transform: translateY(-12px); }
    60% { transform: translateY(-4px); }
  }

  /* Idle bob */
  .pup-body {
    animation: idle-bob 3s ease-in-out infinite alternate;
  }

  @keyframes idle-bob {
    0% { transform: translateY(0) rotate(0deg); }
    100% { transform: translateY(-5px) rotate(2deg); }
  }

  /* Thought bubble */
  .thought-bubble {
    position: absolute;
    top: -10px;
    left: -20px;
    background: white;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(42, 127, 255, 0.15);
    border: 2px solid var(--blue-light);
    opacity: 0;
    transform: scale(0.5) translateY(10px);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    pointer-events: none;
  }

  .thought-bubble::after {
    content: '';
    position: absolute;
    bottom: -8px;
    right: 10px;
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    border: 2px solid var(--blue-light);
  }

  .thought-bubble.visible {
    opacity: 1;
    transform: scale(1) translateY(0);
  }

  /* Hide on very small screens to avoid obstructing content */
  @media (max-width: 420px) {
    .blue-pup-container {
      display: none;
    }
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .pup-body {
      animation: none;
    }
    .blue-pup-container,
    .thought-bubble {
      transition: none;
    }
    .blue-pup-container.bouncing .pup-body {
      animation: none;
    }
  }
</style>
