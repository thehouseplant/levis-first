---
interface Props {
  /**
   * Your Formspree form ID.
   * Sign up at https://formspree.io, create a form, and paste the ID here.
   * It looks like "xyzabcde" from the endpoint https://formspree.io/f/xyzabcde
   */
  formspreeId?: string;
}

const { formspreeId = "YOUR_FORMSPREE_ID" } = Astro.props;
const action = `https://formspree.io/f/${formspreeId}`;
---

<section class="rsvp-section" id="rsvp">
  <div class="rsvp-wrapper">
    <div class="paw-divider" aria-hidden="true">
      <svg viewBox="0 0 60 60" width="28" fill="var(--blue)">
        <ellipse cx="30" cy="38" rx="14" ry="16" />
        <ellipse cx="16" cy="20" rx="7" ry="8" />
        <ellipse cx="44" cy="20" rx="7" ry="8" />
        <ellipse cx="22" cy="10" rx="6" ry="7" />
        <ellipse cx="38" cy="10" rx="6" ry="7" />
      </svg>
    </div>

    <h2 class="section-title">RSVP</h2>
    <p class="section-subtitle">Let us know you'll be joining the party!</p>

    <div class="form-card">
      <div class="notebook-edge" aria-hidden="true">
        <span class="ring"></span>
        <span class="ring"></span>
        <span class="ring"></span>
        <span class="ring"></span>
        <span class="ring"></span>
      </div>

      <form
        action={action}
        method="POST"
        class="rsvp-form"
        id="rsvp-form"
      >
        <div class="form-group">
          <label for="rsvp-name" class="form-label">Your Name</label>
          <input
            type="text"
            id="rsvp-name"
            name="name"
            required
            placeholder="e.g. The Johnson Family"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="rsvp-guests" class="form-label">Number of Guests</label>
          <input
            type="number"
            id="rsvp-guests"
            name="guests"
            required
            min="1"
            max="20"
            placeholder="e.g. 4"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="rsvp-message" class="form-label">Message <span class="optional">(optional)</span></label>
          <textarea
            id="rsvp-message"
            name="message"
            rows="3"
            placeholder="Any dietary needs, questions, or birthday wishes..."
            class="form-input form-textarea"
          ></textarea>
        </div>

        <button type="submit" class="submit-btn" id="rsvp-submit">
          <svg viewBox="0 0 60 60" width="18" fill="white" style="flex-shrink:0">
            <ellipse cx="30" cy="38" rx="14" ry="16" />
            <ellipse cx="16" cy="20" rx="7" ry="8" />
            <ellipse cx="44" cy="20" rx="7" ry="8" />
            <ellipse cx="22" cy="10" rx="6" ry="7" />
            <ellipse cx="38" cy="10" rx="6" ry="7" />
          </svg>
          Count Me In!
        </button>
      </form>

      <!-- Success state -->
      <div class="form-success" id="rsvp-success" hidden>
        <div class="success-paw" aria-hidden="true">
          <svg viewBox="0 0 60 60" width="48" fill="var(--green)">
            <ellipse cx="30" cy="38" rx="14" ry="16" />
            <ellipse cx="16" cy="20" rx="7" ry="8" />
            <ellipse cx="44" cy="20" rx="7" ry="8" />
            <ellipse cx="22" cy="10" rx="6" ry="7" />
            <ellipse cx="38" cy="10" rx="6" ry="7" />
          </svg>
        </div>
        <h3 class="success-title">You're on the list!</h3>
        <p class="success-text">Thanks for RSVPing — we can't wait to see you at Levi's party!</p>
      </div>
    </div>
  </div>
</section>

<script>
  function initRSVP() {
    const form = document.getElementById('rsvp-form') as HTMLFormElement | null;
    const success = document.getElementById('rsvp-success') as HTMLElement | null;
    const submitBtn = document.getElementById('rsvp-submit') as HTMLButtonElement | null;
    if (!form || !success || !submitBtn) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';

      try {
        const resp = await fetch(form.action, {
          method: 'POST',
          body: new FormData(form),
          headers: { 'Accept': 'application/json' },
        });

        if (resp.ok) {
          form.hidden = true;
          success.hidden = false;
        } else {
          throw new Error('Form submission failed');
        }
      } catch {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Count Me In!';
        alert('Something went wrong — please try again or email us directly.');
      }
    });
  }

  initRSVP();
</script>

<style>
  .rsvp-section {
    padding: 5rem 1.5rem;
    background:
      radial-gradient(ellipse at 50% 30%, rgba(42, 127, 255, 0.04) 0%, transparent 60%),
      var(--soft-white);
  }

  .rsvp-wrapper {
    max-width: 520px;
    margin: 0 auto;
    text-align: center;
  }

  .paw-divider {
    margin-bottom: 1rem;
    opacity: 0.6;
    filter: drop-shadow(0 2px 4px rgba(42, 127, 255, 0.15));
  }

  .section-title {
    font-size: clamp(1.8rem, 5vw, 2.5rem);
    font-weight: 800;
    color: var(--navy);
    margin-bottom: 0.3rem;
  }

  .section-subtitle {
    font-size: clamp(0.95rem, 2.5vw, 1.1rem);
    color: var(--navy);
    opacity: 0.6;
    margin-bottom: 2rem;
    font-weight: 400;
  }

  .form-card {
    background: white;
    border-radius: 16px;
    padding: 2rem 2rem 2rem 2.5rem;
    position: relative;
    box-shadow:
      0 4px 20px rgba(42, 127, 255, 0.08),
      0 1px 4px rgba(0, 0, 0, 0.04);
    border: 2px solid var(--blue-light);
    text-align: left;
  }

  /* Notebook spiral edge */
  .notebook-edge {
    position: absolute;
    left: -10px;
    top: 20px;
    bottom: 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .ring {
    width: 18px;
    height: 18px;
    border: 2.5px solid #c8c8c8;
    border-radius: 50%;
    background: var(--soft-white);
  }

  /* Form styles */
  .rsvp-form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }

  .form-label {
    font-family: var(--font-display);
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--blue-dark);
  }

  .optional {
    font-family: var(--font-body);
    font-weight: 400;
    font-size: 0.8rem;
    color: var(--navy);
    opacity: 0.45;
  }

  .form-input {
    font-family: var(--font-body);
    font-size: 1rem;
    font-weight: 500;
    color: var(--navy);
    padding: 0.7rem 1rem;
    border: 2px solid var(--blue-light);
    border-radius: 12px;
    background: var(--cream);
    outline: none;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .form-input::placeholder {
    color: var(--navy);
    opacity: 0.3;
  }

  .form-input:focus {
    border-color: var(--blue);
    box-shadow: 0 0 0 3px rgba(42, 127, 255, 0.12);
  }

  .form-textarea {
    resize: vertical;
    min-height: 80px;
  }

  /* Number input — hide spin buttons on some browsers */
  .form-input[type="number"]::-webkit-inner-spin-button,
  .form-input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  .form-input[type="number"] { -moz-appearance: textfield; }

  .submit-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-family: var(--font-display);
    font-size: 1.1rem;
    font-weight: 700;
    color: white;
    background: linear-gradient(135deg, var(--blue), var(--blue-dark));
    padding: 0.85rem 2rem;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    box-shadow:
      0 4px 15px rgba(42, 127, 255, 0.3),
      0 1px 3px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    align-self: center;
    margin-top: 0.5rem;
  }

  .submit-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow:
      0 6px 20px rgba(42, 127, 255, 0.4),
      0 2px 6px rgba(0, 0, 0, 0.1);
  }

  .submit-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  /* Success state */
  .form-success {
    text-align: center;
    padding: 1rem 0;
    animation: fade-up 0.5s ease-out;
  }

  @keyframes fade-up {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .success-paw {
    margin-bottom: 0.75rem;
    filter: drop-shadow(0 3px 6px rgba(78, 194, 78, 0.25));
  }

  .success-title {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--green-dark);
    margin-bottom: 0.3rem;
  }

  .success-text {
    font-size: 1rem;
    color: var(--navy);
    opacity: 0.7;
    line-height: 1.5;
  }

  @media (max-width: 500px) {
    .form-card {
      padding: 1.5rem 1.25rem 1.5rem 1.75rem;
    }
    .notebook-edge {
      top: 15px;
      bottom: 15px;
    }
    .ring {
      width: 15px;
      height: 15px;
    }
  }
</style>
